---
- name: "ğŸ”§ Stack Deployment with Selective Become"
  hosts: localhost
  gather_facts: yes
  connection: local
  
  tasks:
    - name: "ğŸ“‹ Show deployment info"
      debug:
        msg: "Starting stack deployment without root"
    
    - name: "ğŸ”„ Update system (requires sudo)"
      become: yes
      become_user: root
      apt:
        update_cache: yes
      ignore_errors: yes  # Ğ˜Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸ Ñ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸
      when: ansible_os_family == "Debian"
    
    - name: "ğŸ“¦ Install Node.js (simulated with become)"
      become: yes
      debug:
        msg: "Installing Node.js with apt (requires sudo)"
      # Ğ ĞµĞ°Ğ»ÑŒĞ½Ğ°Ñ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ±Ñ‹Ğ»Ğ° Ğ±Ñ‹:
      # apt:
      #   name: nodejs
      #   state: present
    
    - name: "ğŸŒ Configure web server (simulated without become)"
      debug:
        msg: "Configuring web server (no sudo needed for simulation)"
    
    - name: "ğŸš€ Deploy app code (simulated without become)"
      debug:
        msg: "Deploying application code (no sudo needed for simulation)"
    
    - name: "âœ… Final verification"
      debug:
        msg: |
          Deployment completed at: {{ ansible_date_time.iso8601 }}
          
          Note: Some tasks required sudo, others didn't.
          This is a common pattern in real deployments.
